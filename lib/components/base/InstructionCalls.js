import{objectSpread2 as a,asyncToGenerator as t}from"../../_virtual/_rollupPluginBabelHelpers.js";import n,{useState as r,useEffect as i}from"react";import{GetUserInstructionCalls as o,AssembleInstructionCallTransaction as e}from"../../api/instruction.js";import{SignAndSendTransaction as s}from"../../api/transaction.js";import"buffer";import"@solana/web3.js";import"bs58";import{Box as l,Table as c,Thead as d,Tr as p,Th as u,Tbody as m,Td as f,Button as h}from"@chakra-ui/react";import{jsx as v,jsxs as b,Fragment as T}from"react/jsx-runtime";import{useConfig as k}from"../../ConfigContext.js";import"@chakra-ui/icons";import"../airdrop/Dashboard.js";import"../airdrop/Instruction.js";import"../airdrop/Task.js";import"@solana/wallet-adapter-phantom";import"@solana/wallet-adapter-solflare";import"@solana/wallet-adapter-react-ui";import"../wallet/WalletModal.js";import"@solana/wallet-adapter-react";var j=j=>{var{authToken:g,wallet:w,instructionType:y,instructionStatus:A,boxProps:x,tableProps:S}=j,[_,P]=r([]),R=k();if("task_caller"===y||"task_initializer"===y)var z=["id","task","transaction status","timestamp"];else z=["id","transaction status","timestamp"];i((()=>{(function(){var n=t((function*(){var t=(yield o(R.backendUrl,R.airdropAppRoot,g,y,A)).map((t=>a(a({},t),{},{transactions:[t.transactions].filter(Boolean)})));P(t||[])}));return function(){return n.apply(this,arguments)}})()()}),[R.backendUrl,R.airdropAppRoot,g,y,A]);var C=a=>a.transaction?a.transaction.status:"NA",U=a=>{switch(C(a)){case"NA":return"Assemble and Send";case"assembled":return"Sign and Send";case"pending":return v(T,{children:"Pending To Confirm"});case"confirmed":return v(T,{children:"Pending To Finalize"});case"finalized":return"Explore";case"failed":return"Resign and Send"}},B=function(){var a=t((function*(a){if(console.log(a),a.transaction&&"failed"!==a.transaction.status){if(a.transaction&&"assembled"===a.transaction.status)yield s(R.backendUrl,R.airdropAppRoot,g,w,a.transaction.id);else if("pending"===a.transaction.status||"confirmed"===a.transaction.status);else if(a.transaction&&"finalized"===a.transaction.status){var t="https://explorer.solana.com/tx/".concat(a.transaction.transaction_hash,"?cluster=devnet");window.open(t,"_blank")}}else yield e(R.backendUrl,R.airdropAppRoot,g,w,a.id)}));return function(t){return a.apply(this,arguments)}}();return v(l,a(a({},x),{},{children:b(c,a(a({},null==S?void 0:S.Table),{},{children:[v(d,a(a({},null==S?void 0:S.Thead),{},{children:b(p,a(a({},null==S?void 0:S.Tr),{},{children:[z.map((t=>v(u,a(a({},null==S?void 0:S.Th),{},{children:t}),t))),v(u,a(a({},null==S?void 0:S.Th),{},{children:"Action"}))]}))})),v(m,a(a({},null==S?void 0:S.Tbody),{},{children:_.map((r=>v(n.Fragment,{children:b(p,a(a({},null==S?void 0:S.Tr),{},{children:[z.map((t=>v(f,a(a({},null==S?void 0:S.Td),{},{children:"transaction status"===t?C(r):r[t]}),"".concat(r.id,"-").concat(t)))),v(f,a(a({},null==S?void 0:S.Td),{},{children:v(h,a(a({},null==S?void 0:S.actionButton),{},{onClick:t((function*(){return B(r)})),children:U(r)}))}))]}))},r.id)))}))]}))}))};export{j as InstructionCalls};
